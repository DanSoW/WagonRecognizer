package com.server.program;

import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.stereotype.Repository;

public class DataElementDaoImplWagons implements DataElementDaoWagons {

	//Main table name
	private static final String NAME_WAGONS_TABLE = "Wagons";
	
	//Attributes
	private static final String NAME_ATTRIBUT_NUMBER_WAGON = "numberWagon";
	private static final String NAME_ATTRIBUT_ARRIVAL_DATE = "arrivalDate";
	private static final String NAME_ATTRIBUT_IMAGE_PATH = "imagePath";
	private static final String NAME_ATTRIBUT_LEVEL_CORRECT = "levelCorrectRecognize";
	
	//Queries to the table in the format of SQL commands
	private static final String SQL_GET_DATA_BY_NUMBER = 
			"SELECT * FROM " + NAME_WAGONS_TABLE + " WHERE " + NAME_ATTRIBUT_NUMBER_WAGON + " = :" + NAME_ATTRIBUT_NUMBER_WAGON;
	private static final String SQL_INSERT_DATA =
			"INSERT INTO " + NAME_WAGONS_TABLE + " (" 
	+ NAME_ATTRIBUT_NUMBER_WAGON 
	+ NAME_ATTRIBUT_ARRIVAL_DATE
	+ NAME_ATTRIBUT_IMAGE_PATH
	+ NAME_ATTRIBUT_LEVEL_CORRECT + ") "
	+ "VALUES ("
	+ ":" + NAME_ATTRIBUT_NUMBER_WAGON 
	+ ":" + NAME_ATTRIBUT_ARRIVAL_DATE
	+ ":" + NAME_ATTRIBUT_IMAGE_PATH
	+ ":" + NAME_ATTRIBUT_LEVEL_CORRECT + ")";
	
	private final DataElementMapper dataMapper;
	private final NamedParameterJdbcTemplate jdbcTemplate;
	
	@Autowired
	public DataElementDaoImplWagons(
			DataElementMapper dMapper,
			NamedParameterJdbcTemplate jTempl
			) {
		this.dataMapper = dMapper;
		this.jdbcTemplate = jTempl;
	}
	
	@Override
	public Optional<DataElementWagons> getDataElementWagonsById(int numberWagon){
		MapSqlParameterSource params = new MapSqlParameterSource();
		params.addValue(NAME_ATTRIBUT_NUMBER_WAGON, numberWagon);
		try {
			return Optional.ofNullable(
					jdbcTemplate.queryForObject(
							SQL_GET_DATA_BY_NUMBER, 
							params, 
							dataMapper)
					);
		}catch(Exception e) {
			return Optional.empty();
		}
	}

	@Override
	public void insertDataElementWagons(int numberWagon, String arrivalDate, String imagePath, double levelCorrectRecognize) {
		MapSqlParameterSource params = new MapSqlParameterSource();
		//добавление значений для ввода данных в таблицу базы данных
		params.addValue("invoices_ID", invoicesId);
		params.addValue("cargo", cargo);
		params.addValue("numberWagon", numberWagon);
		params.addValue("pathImage", pathImage);
		params.addValue("numberOrder", numberOrder);
		params.addValue("dateArrival", dateArrival);
		jdbcTemplate.update(SQL_INSERT_DATA, params); //выполнение запроса
	}
}
